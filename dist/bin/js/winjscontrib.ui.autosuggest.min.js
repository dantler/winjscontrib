/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{AutoSuggest:WinJS.Class.mix(WinJS.Class.define(function(t,e){var n=this;this.element=t||document.createElement("DIV"),e=e||{},this.element.winControl=this,this.element.classList.add("win-disposable"),this.maxHeight=200,this.eventTracker=new WinJSContrib.UI.EventTracker,this.input=document.createElement("INPUT"),this.flyout=document.createElement("DIV"),this.flyout.className="mcn-autosuggest-flyout",this.flyout.style.display="none",this.flyoutVisible=!1,this.element.appendChild(this.input),document.body.appendChild(this.flyout),this.flyoutContent=document.createElement("DIV"),this.flyoutContent.className="mcn-autosuggest-flyoutcontent",this.flyout.appendChild(this.flyoutContent),this.eventTracker.addEvent(this.input,"input",this.inputChanged.bind(this)),this.eventTracker.addEvent(document.body,"click",function(){n.hideFlyout()});var i="click";this.eventTracker.addEvent(this.flyout,i,function(t){t.stopPropagation(),t.stopImmediatePropagation()}),WinJS.UI.setOptions(this,e)},{value:{get:function(){return this.input.value},set:function(t){this.input.value=t}},placeholderText:{get:function(){return this.input.getAttribute("placeholder").value},set:function(t){this.input.setAttribute("placeholder",t)}},inputChanged:function(t){var e=this;if(e.input.value&&e.input.value!=e.lastinput){e.lastinput=e.input.value;var n=[],i=[],t={queryText:e.input.value,searchSuggestionCollection:{appendResultSuggestion:function(t,e,n,s){i.push({title:t,desc:e,data:n,options:s})}},setPromise:function(t){n.push(t)}};e.dispatchEvent("suggestionsrequested",t),WinJS.Promise.join(n).then(function(){console.log("suggestions ok "+i.length),e.flyoutContent.innerHTML="";var t=document.createDocumentFragment();i.forEach(function(n){var i=document.createElement("DIV");i.className="mcn-autosuggest-item",n.options&&n.options.template?e.renderItemFromTemplate(n.data,i,n.options.template):e.renderItem(n,i),t.appendChild(i),i.onclick=function(){e.dispatchEvent("resultsuggestionchosen",{tag:n.data}),e.hideFlyout()}}),e.flyoutContent.appendChild(t),e.showFlyout()},function(t){console.log("suggestions cancel")})}},renderItemFromTemplate:function(t,e,n){n.winControl&&(n=n.winControl),"function"==typeof n?n(WinJS.Promise.wrap(t)).then(function(t){e.appendChild(t)}):n.render&&n.render(t).then(function(t){e.appendChild(t)})},renderItem:function(t,e){if(s.options&&s.options.cssIcon){var n=document.createElement("DIV");n.className="cssicon "+s.options.cssIcon,e.appendChild(n)}var i=document.createElement("DIV");i.className="mcn-autosuggest-content",e.appendChild(i);var o=document.createElement("DIV");if(o.className="title",o.innerText=s.title,i.appendChild(o),s.desc){var l=document.createElement("DIV");l.className="desc",l.innerText=s.desc,i.appendChild(l)}},updateFlyoutPosition:function(){var t=this,e=t.element.getBoundingClientRect();t.flyout.style.position="absolute",t.flyout.style.left=e.left+"px",t.flyout.style.width=e.width+"px",t.flyout.style.top=e.top+e.height+"px",t.flyout.style.maxHeight=Math.min(t.maxHeight,document.body.clientHeight-e.top-e.height-50)+"px"},hideFlyout:function(){var t=this;t.flyout.style.display="none",t.flyoutVisible=!1},showFlyout:function(){var t=this;t.updateFlyoutPosition(),t.flyout.style.display="",t.flyoutVisible=!0},dispose:function(){this.eventTracker.dispose(),document.body.removeChild(this.flyout),WinJS.Utilities.disposeSubTree(this.element),this.element=null}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("suggestionsrequested","resultsuggestionchosen"))})}();