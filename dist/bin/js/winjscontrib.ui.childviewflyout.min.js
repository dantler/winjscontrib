/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){var e=WinJSContrib.Logs.getLogger("WinJSContrib.UI.ChildViewFlyout");WinJS.Namespace.define("WinJSContrib.UI",{parentChildView:function(e){for(var i=e.parentNode;i;){if(i.mcnChildnav)return i.winControl;i=i.parentNode}},ChildViewFlyout:WinJS.Class.mix(WinJS.Class.define(function(e,i){e.winControl=this,i=i||{},this.element=e||document.createElement("div"),i.inplace?this.rootElement=this.element:(this.rootElement=document.createElement("div"),this.rootElement.mcnChildnav=!0,this.rootElement.winControl=this,this.element.style.display="none"),document.body.appendChild(this.rootElement),this.navigationEvents=i.navigationEvents,this.element.mcnChildnav=!0,this.element.classList.add("mcn-childview"),this.element.classList.add("win-disposable"),this.rootElement.classList.add("childNavigator"),this.rootElement.classList.add("hidden"),this.element.classList.add("mcn-navigation-ctrl"),this.target=i.target||null,this._createContent(i),this.hardwareBackBtnPressedBinded=this.hardwareBackBtnPressed.bind(this),this.childContentKeyUp=this._childContentKeyUp.bind(this)},{_createContent:function(e){{var i=this,n=WinJSContrib.UI.FluentDOM;new n("DIV")}i.overlay=new n("DIV").addClass("childNavigator-overlay").appendTo(i.rootElement).tap(function(){i.hide()},{disableAnimation:!0,disableAria:!0}).element,i.contentPlaceholder=new n("DIV","childNavigator-contentPlaceholder",i.rootElement).append("DIV",null,function(e){i.navigator=new WinJSContrib.UI.PageControlNavigator(e.element,{global:!1}),i.navigator.animations.enterPage=WinJS.UI.Animation.fadeIn,i.navigator.hide=function(e){return i.hide(e)}}).element,e&&e.closeBtn&&e.closeBtn.active&&(i.closebtn=new n("DIV","mcn-close-btn",i.contentPlaceholder),e.closeBtn.templatetext&&i.closebtn.html(e.closeBtn.templatetext),e.closeBtn["class"]?i.closebtn.className(i.closebtn.element.className+" "+e.closeBtn["class"]):e.closeBtn.templatetext||i.closebtn.className(i.closebtn.element.className+" default-icon"),WinJSContrib.UI.tap(i.closebtn.element,function(){return i.closePage()}))},navigate:function(e,i,n){var t=this;return t.navigator.navigate(e,i)},pageControl:{get:function(){return this.container&&this.container.winControl}},isOpened:{get:function(){return this.contentPlaceholder.classList.contains("enter")||this.contentPlaceholder.classList.contains("enter-active")}},clear:function(i){var n=this;return e.debug("clear"),new WinJS.Promise(function(e,t){WinJS.Promise.wrap(n.closePage(null,null,i)).done(function(){n.navigator.clear(),n.navigator.element.innerText="",n.location=void 0,e()})})},checkStack:function(e){var i=this;return 0==i.navigator.pagesCount?i.hide(e,null,!0):void 0},closePage:function(i,n,t){var o=this,a=n&&n.winControl?n.winControl:o.navigator.pageControl;e.debug("close page "+(a?a.uri:""));var s=t?WinJS.Promise.wrap(!0):o.canClose(a),r=s.then(function(e){if(!e)return WinJS.Promise.wrapError({message:"close canceled by user"});o.navigator.pagesCount;return o.navigator.triggerPageExit(),o.navigator.closePage(n).then(function(){return WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide(),o.checkStack(i)})},function(e){console.warn("close childview error",e)});return o.closePagePromise=o.closePagePromise?o.closePagePromise.then(function(){return r},function(){}).then(function(){return t?WinJS.Promise.wrap(!0):o.canClose(a)},function(e){}):r,r},back:function(e){var i=this;return i.navigator.back(e)},canGoBack:function(){return that.navigator.canGoBack},_childContentKeyUp:function(e){"Esc"===e.key&&this.hide()},hardwareBackBtnPressed:function(e){var i=this;i.navigator._checkBackNavigation(e)||(i.hide(),e.handled=!0)},show:function(i){var n=this;return e.verbose("showing childview"),n.target&&n.target.classList.add("childview-target"),n.isOpened?WinJS.Promise.wrap():(e.verbose("show exec"),WinJSContrib.UI&&WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager.appViewBackButtonVisibility===window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.visible)),document.body.addEventListener("keyup",n.childContentKeyUp),this.addDismissableClass("visible"),this.addDismissableClass("enter"),this.removeDismissableClass("leave"),this.removeDismissableClass("hidden"),n.rootElement.getBoundingClientRect(),n.navEventsHandler=WinJSContrib.UI.registerNavigationEvents(n,this.hardwareBackBtnPressedBinded),n.navigationEvents&&n.navigator.addNavigationEvents(),n.showChildViewPromise=WinJS.Promise.timeout().then(function(){return n.hideChildViewPromise}).then(function(){return n.hideChildViewPromise=null,n.addDismissableClass("enter-active"),n.addDismissableClass("visible"),n.addDismissableClass("enter"),n.removeDismissableClass("leave"),n.removeDismissableClass("hidden"),WinJSContrib.UI.afterTransition(n.contentPlaceholder).then(function(){n.contentPlaceholder.classList.contains("enter")})}),n.showChildViewPromise)},addDismissableClass:function(e){var i=this;i.overlay.classList.add(e),i.contentPlaceholder.classList.add(e),i.rootElement.classList.add(e),i.target&&i.target.classList.add("childview-"+e)},removeDismissableClass:function(e){var i=this;i.overlay.classList.remove(e),i.overlay.classList.remove(e+"-active"),i.contentPlaceholder.classList.remove(e),i.contentPlaceholder.classList.remove(e+"-active"),i.rootElement.classList.remove(e),i.rootElement.classList.remove(e+"-active"),i.target&&(i.target.classList.remove("childview-"+e),i.target.classList.remove("childview-"+e+"-active"))},_pick:function(i,n,t,o){var a=this;n=n||{},a.pickPromises=a.pickPromises||[];var s={completed:!1,childviewpage:null,promise:null,completeCallback:null,errorCallback:null,manageClose:null,attachPage:function(e){this.detachPage(),this.childviewpage=e,e&&e.element&&e.addEventListener("closing",this.manageClose)},detachPage:function(e){this.childviewpage&&this.childviewpage.element&&this.childviewpage.removeEventListener&&this.childviewpage.removeEventListener("closing",this.manageClose)},dispose:function(){}};s.promise=new WinJS.Promise(function(r,l){s.completed=!1,s.childviewpage=null,s.completeCallback=r,s.errorCallback=l,s.manageClose=function(i,n,t){try{s.detachPage(),a.removeEventListener("beforehide",s.manageClose)}catch(o){console.error(o)}s.completed||(s.completed=!0,e.verbose("closing childview page hasresult:"+n,t),r({completed:n,data:t}))},s.injectToPage={close:function(e){return a.canClose(s.childviewpage).then(function(){s.manageClose(null,!0,e);try{s.detachPage(),a.removeEventListener("beforehide",s.manageClose)}catch(i){console.error(i)}s.childviewpage&&s.childviewpage.element&&a.closePage(e,s.childviewpage.element,!0)})},cancel:function(){var e=this.element||this.rootElement;return a.canClose(e.winControl).then(function(){s.manageClose(null,!1),a.closePage()})}},n.navigateStacked=t,n.injectToPage=s.injectToPage,a.pickPromises.push(s),a.open(i,n,o).then(function(n){e.debug("picking with childview page "+i),a.addEventListener("beforehide",s.manageClose,!1)})});var r=function(){var e=a.pickPromises.indexOf(s);a.pickPromises.splice(e,1)};return s.promise.then(r,r),s.promise},pick:function(e,i,n){var t=this;return t._pick(e,i,!0,n)},open:function(i,n,t){var o=this;WinJS.Application.queueEvent({type:"mcn-childviewflyout-open",detail:{location:i,options:n}}),n=n||{};var a;return o.pickPromises&&o.pickPromises.length&&(a=o.pickPromises[o.pickPromises.length-1],n.injectToPage=a.injectToPage,a.detachPage()),o.rootElement.classList.add("visible"),o.dispatchEvent("beforeshow"),e.verbose("opening "+i,n),o.openChildViewPromise=new WinJS.Promise(function(e,s){WinJS.Promise.as(o.hideChildViewPromise).then(function(){var e=WinJS.Promise.wrap();return o.isOpened||(e=o.show(!0)),WinJS.Promise.join({show:WinJSContrib.UI.afterTransition(o.contentPlaceholder),navigate:o.navigate(i,n,t).done(function(e){o.dispatchEvent("aftershow"),a&&a.attachPage(o.navigator.pageControl)})})}).then(e,s)}),o.openChildViewPromise},canClose:function(e){return e=e||this.navigator.pageControl,e&&e.canClose&&e.element&&!e.element.classList.contains("page-closing")?WinJS.Promise.as(e.canClose()).then(function(e){return e}):WinJS.Promise.wrap(!0)},hide:function(i,n,t){var o=this;if(e.verbose("hiding childview"),o.isOpened){o.showChildViewPromise=null,o.closePagePromise=null,o.openChildViewPromise=null;var a=t?WinJS.Promise.wrap(!0):o.canClose(),s=o.navigator.element.children,r=o.hideChildViewPromise;return o.hideChildViewPromise=a.then(function(e){return WinJS.Promise.as(r).then(function(){return e})}).then(function(n){return n?o.isOpened?(e.verbose("hide exec"),o.addDismissableClass("leave"),o.removeDismissableClass("enter"),o.pickPromises&&o.pickPromises.forEach(function(e){e.promise.cancel()}),document.body.removeEventListener("keyup",o.childContentKeyUp),o.dispatchEvent("beforehide",i),o.navigator.canGoBack||WinJS.Navigation.canGoBack||WinJSContrib.UI&&WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager.appViewBackButtonVisibility===window.Windows.UI.Core.AppViewBackButtonVisibility.visible&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed)),o.navEventsHandler&&(o.navEventsHandler(),o.navigator.removeNavigationEvents(),o.navEventsHandler=null),WinJS.Promise.timeout().then(function(){return o.addDismissableClass("leave-active"),WinJS.Promise.join({overlay:WinJSContrib.UI.afterTransition(o.overlay,1e3),content:WinJSContrib.UI.afterTransition(o.contentPlaceholder,1e3)}).then(function(){if(o.contentPlaceholder.classList.contains("leave")&&(o.clear(!0),o.removeDismissableClass("visible"),o.addDismissableClass("hidden"),o.removeDismissableClass("leave"),o.dispatchEvent("afterhide",i)),s&&s.length)for(var e=0;e<s.length;e++){var n=s[e];n.winControl.mcnPageClosing||o.closePage(null,n)}})})):void 0:!1}),o.hideChildViewPromise}return WinJS.Promise.wrap(!0)},dispose:function(){this.rootElement.winControl=null,WinJS.Utilities.disposeSubTree(this.rootElement),WinJS.Utilities.disposeSubTree(this.element),this.rootElement.parentElement.removeChild(this.rootElement)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("beforeshow","beforehide","aftershow","afterhide"))})}();