/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{SmartListLayout:WinJS.Class.define(function(t,i){this._element=t||document.createElement("div"),this._element.className=this._element.className+" win-disposable mcn-layout-ctrl",this._element.winControl=this,this.queries=[],i&&(i.listView&&(this.listView=i.listView),i.layouts&&(this.layouts=i.layouts))},{listView:{get:function(){return this._listview},set:function(t){this._listview=t&&t.element&&t.forceLayout?t.element:t,t&&(this.initQueries(this.layouts),this.applyPendingLayout())}},layouts:{get:function(){return this._layouts},set:function(t){this._layouts=t,this._layouts&&(this.initQueries(this._layouts),this.applyPendingLayout())}},initQueries:function(t){var i=this;for(var e in t)t.hasOwnProperty(e)&&i.add(t[e])},add:function(t){var i=this;if(t&&t.query&&t.layout){var e={ctrl:i,mediaquery:t.query,layout:t.layout,options:t.options,mq:void 0,bindedCallback:void 0};e.bindedCallback=i.processQuery.bind(e),i.queries.push(e),e.mq=window.matchMedia(t.query),e.mq.addListener(e.bindedCallback),e.mq.matches&&i.applyQuery(e)}},processQuery:function(t){var i=this;i.ctrl.applyQuery(i)},applyQuery:function(t){var i=this;t.mq.matches&&i.listView&&i.listView.winControl&&(i.pendingLayout||(i.listView.style.opacity=0,setImmediate(function(){i.applyPendingLayout()})),i.pendingLayout=new t.layout(t.options))},applyPendingLayout:function(){var t=this;t.pendingLayout&&(t.listView.winControl.layout=t.pendingLayout,t.listView.style.opacity=1,t.listView.winControl.forceLayout(),t.pendingLayout=void 0)},updateLayout:function(){},pageLayout:function(){var t=this;if(t.listView){var i=WinJSContrib.Utils.getParentControlByClass("win-semanticzoom",t.listView);i&&i.forceLayout()}},forceListUpdate:function(){var t=this;t.listView.winControl._batchingViewUpdates&&(t.listView.winControl._batchingViewUpdates.cancel(),t.listView.winControl._batchingViewUpdates=null),t.listView.winControl.forceLayout()},dispose:function(){var t=this;t.queries.forEach(function(t){t.mq.removeListener(t.bindedCallback)})}})}),WinJSContrib.UI.WebComponents&&WinJSContrib.UI.WebComponents.register("mcn-smartlistlayout",WinJSContrib.UI.SmartListLayout,{properties:["listView","layouts"]})}();