/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";function e(e){}WinJS.Namespace.define("WinJSContrib.UI",{SwipeSlide:WinJS.Class.mix(WinJS.Class.define(function(e,t){this.element=e||document.createElement("DIV"),t=t||{},this.moveDivider=t.moveDivider||1,this.threshold=t.threshold||40,this.touchOnly=!1,this.minSwipeDistance=t.minSwipeDistance||100,this.direction=t.direction||"horizontal",this.element.winControl||(this.element.winControl=this),this.element.classList.add("mcn-swipeslide"),this.element.classList.add("win-disposable"),this.target=this.element,this.eventTracker=new WinJSContrib.UI.EventTracker,this.ptDown=null,this.registerEvents(),this.allowed=t.allowed||{left:!0,right:!0,top:!1,bottom:!1},this.disabled=!1,WinJS.UI.setOptions(this,t),this.thresholdFactor=this.thresholdFactor||4},{registerEvents:function(){void 0!==this.element.onpointerdown?(this.eventTracker.addEvent(this.element,"pointerdown",this._processDown.bind(this),!1),this.eventTracker.addEvent(this.element,"pointerup",this._processUp.bind(this),!1),this.eventTracker.addEvent(this.element,"pointercancel",this._processCancel.bind(this),!1),this.eventTracker.addEvent(this.element,"pointermove",this._processMove.bind(this),!1)):window.Touch?(this.eventTracker.addEvent(this.element,"touchstart",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"touchend",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"touchcancel",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"touchmove",this._processMove.bind(this),!0)):(this.eventTracker.addEvent(this.element,"mousedown",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"mouseup",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"mouseleave",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"mousemove",this._processMove.bind(this),!0))},_initPtDown:function(e){var t=0,i=0;if(e.changedTouches){if(window.WebKitCSSMatrix){var s=new window.WebKitCSSMatrix(this.target.style.transform||this.target.style.webkitTransform||"");t=s.m41,i=s.m42}this.ptDown={x:e.changedTouches[0].screenX,y:e.changedTouches[0].screenY,confirmed:!1,transformOffsetX:t,transformOffsetY:i}}else{if(window.MSCSSMatrix){var s=new window.MSCSSMatrix(this.target.style.transform);t=s.m41,i=s.m42}this.ptDown={x:e.screenX,y:e.screenY,confirmed:!1,transformOffsetX:t,transformOffsetY:i,maxDX:0,maxDY:0}}},_processDown:function(e){this.disabled||(this.capturePointerOnDown&&(e.preventDefault(),e.stopPropagation()),this._initPtDown(e))},_processLeave:function(e){{var t=this;e.currentTarget||e.target}console.log("pointer leave"),t._processUp(e)},_processCancel:function(e){{var t=this;e.currentTarget||e.target}console.log("pointer cancel");e.currentTarget||e.target;if(e.pointerId&&t.element.releasePointerCapture)try{t.element.releasePointerCapture(e.pointerId)}catch(i){}t._cancelMove(),t.ptDown=null,t.dispatchEvent("swipeend")},_processUp:function(t){{var i=this;t.currentTarget||t.target}if(t.pointerId&&i.element.releasePointerCapture)try{i.element.releasePointerCapture(t.pointerId)}catch(s){}if(i.ptDown){if(t.changedTouches)var n=i.ptDown.x-t.changedTouches[0].screenX,o=i.ptDown.y-t.changedTouches[0].screenY;else var n=i.ptDown.x-t.screenX,o=i.ptDown.y-t.screenY;var r=this.ptDown.transformOffsetX+(-n-this.threshold)/(window.devicePixelRatio*this.moveDivider);"vertical"==i.direction&&(r=this.ptDown.transformOffsetY+(-o-this.threshold)/(window.devicePixelRatio*this.moveDivider));var a=!0;if(t.pointerId&&this.touchOnly&&"touch"!=t.pointerType&&(a=!1),a&&i._acceptSwipe(r)){this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent);var h={dX:n,dY:o,move:-n-i.threshold,screenMove:i.ptDown.screenMove,direction:n>0?"left":"right",handled:!1};"vertical"==i.direction&&(h.move=-o-i.threshold,h.direction=o>0?"top":"bottom"),"left"==h.direction&&i.allowed.left||"right"==h.direction&&i.allowed.right||"top"==h.direction&&i.allowed.top||"bottom"==h.direction&&i.allowed.bottom?(i.dispatchEvent("swipe",h),e("swipe slide, swipeHandled "+i.swipeHandled+"/"+h.handled+"/"+i.zurgl),i.swipeHandled||i._cancelMove()):i._cancelMove()}else this.ptDown.maxDX<i.threshold&&this.ptDown.maxDY<i.threshold?(i.dispatchEvent("invoked",h),i.swipeHandled||i._cancelMove()):i._cancelMove()}else i._cancelMove();i.ptDown=null,i.dispatchEvent("swipeend")},_acceptSwipe:function(e){var t=this,i=Math.abs(e);return i<t.minSwipeDistance?!1:"vertical"==t.direction?i>t.element.clientHeight/t.thresholdFactor:i>t.element.clientWidth/t.thresholdFactor},_toSize:function(e){return 0!==e?e+"px":"0px"},_cancelMove:function(){var t=this,i=this.target,s=0,n=0;this.ptDown&&(s=this.ptDown.transformOffsetX,n=this.ptDown.transformOffsetY),this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent),e("swipe slide, cancel move "+s+"/"+n),i&&(i.style.transition="transform 120ms ease-out",i.style.hasOwnProperty("webkitTransition")&&(i.style.webkitTransition="transform 90ms ease-out"),setImmediate(function(){i.style.transform="translate3d("+t._toSize(s)+", "+t._toSize(n)+", 0px)",i.style.hasOwnProperty("webkitTransform")&&(i.style.webkitTransform="translate3d("+t._toSize(s)+", "+t._toSize(n)+", 0px)"),setTimeout(function(){i.style.transition="",i.style.hasOwnProperty("webkitTransition")&&(i.style.webkitTransition="")},100)}))},_processMove:function(t){var i=this;if(!this.disabled)if(!this.ptDown&&t.changedTouches&&this._initPtDown(t),this.ptDown){var s=!0;if(t.pointerId&&this.touchOnly&&"touch"!=t.pointerType&&(s=!1),!s)return;if(t.changedTouches)var n=this.ptDown.x-t.changedTouches[0].screenX,o=this.ptDown.y-t.changedTouches[0].screenY;else var n=this.ptDown.x-t.screenX,o=this.ptDown.y-t.screenY;var r=Math.abs(n),a=Math.abs(o);this.ptDown.maxDX=Math.max(this.ptDown.maxDX,r),this.ptDown.maxDY=Math.max(this.ptDown.maxDY,a),"vertical"==i.direction?a>5&&a>r&&(t.preventDefault(),t.stopPropagation()):r>5&&r>a&&(t.preventDefault(),t.stopPropagation());var h=0;if(h="vertical"==i.direction?this.ptDown.transformOffsetY+(-o-this.threshold)/(window.devicePixelRatio*this.moveDivider):this.ptDown.transformOffsetX+(-n-this.threshold)/(window.devicePixelRatio*this.moveDivider),!this.ptDown.confirmed)if("vertical"==i.direction){if(r>this.threshold)return void(this.ptDown=null);if(a>this.threshold){this.ptDown.confirmed=!0,this.swipeHandled=!1,e("start swipe");var c={dX:n,dY:o,move:-o-i.threshold,screenMove:i.ptDown.screenMove,direction:o>0?"top":"bottom",handled:!1};this.dispatchEvent("swipestart",c);{t.currentTarget||t.target}t.pointerId&&this.element.setPointerCapture&&this.element.setPointerCapture(t.pointerId)}}else{if(a>this.threshold)return void(this.ptDown=null);if(r>this.threshold){this.ptDown.confirmed=!0,this.swipeHandled=!1,e("start swipe");var c={dX:n,dY:o,move:-n-i.threshold,screenMove:i.ptDown.screenMove,direction:n>0?"left":"right",handled:!1};this.dispatchEvent("swipestart",c);{t.currentTarget||t.target}t.pointerId&&this.element.setPointerCapture&&this.element.setPointerCapture(t.pointerId)}}if(this.ptDown.confirmed){if("vertical"==i.direction){e("swipe move "+o+" / "+h);var d=this.setMove(h,-o),c={screenMove:d,move:-o-this.threshold,direction:o>0?"top":"bottom",accept:i._acceptSwipe(h),dX:n,dY:o}}else{e("swipe move "+n+" / "+h);var d=this.setMove(h,-n),c={screenMove:d,move:-n-this.threshold,direction:n>0?"left":"right",accept:i._acceptSwipe(h),dX:n,dY:o}}this.dispatchEvent("swipeprogress",c)}}else e("swipe move")},setMove:function(t,i){var s=this;if("vertical"==s.direction){var n=this.element.clientHeight;i>0&&!this.allowed.bottom?(t=Math.sqrt(t),t>n/6&&(t=n/6)):0>i&&!this.allowed.top&&(t=-Math.sqrt(-t),-(n/6)>t&&(t=-(n/6)))}else{var n=this.element.clientWidth;i>0&&!this.allowed.right?(t=Math.sqrt(t),t>n/6&&(t=n/6)):0>i&&!this.allowed.left&&(t=-Math.sqrt(-t),-(n/6)>t&&(t=-(n/6)))}return this.minMoveBounds&&t<this.minMoveBounds&&(t=this.minMoveBounds),this.maxMoveBounds&&t>this.maxMoveBounds&&(t=this.maxMoveBounds),this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent),s.ptDown&&(s.ptDown.screenMove=t),this.setMoveIntent=requestAnimationFrame(function(){this.setMoveIntent=null,e("transform to "+t);var i="translate3d("+s._toSize(t)+", 0px, 0px)";"vertical"==s.direction&&(i="translate3d(0px, "+s._toSize(t)+", 0px)"),void 0!==s.target.style.webkitTransform?s.target.style.webkitTransform=i:s.target.style.transform=i}),t},dispose:function(){this.eventTracker.dispose();try{WinJS.Utilities.disposeSubTree(this.element)}catch(e){}}}),WinJS.UI.DOMEventMixin,WinJS.Utilities.createEventProperties("swipe","swipeprogress","swipestart"))})}();