/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},WinJSContrib;!function(e){var t;!function(t){var i=[1,2,3,4,5,6,7,8,9,10,11,12],n=[12,1,2,3,4,5,6,7,8,9,10,11],s=[13,14,15,16,17,18,19,20,21,22,23,0],r=[0,13,14,15,16,17,18,19,20,21,22,23],o=[5,10,15,20,25,30,35,40,45,50,55,0],a=[0,5,10,15,20,25,30,35,40,45,50,55],l=function(){function t(t,i){var n=this;this.element=t||document.createElement("DIV"),i=i||{},this.element.winControl=this,this.element.classList.add("mcn-timepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.flyout.element.classList.add("mcn-timepicker-flyout");var s=WinJS.Resources.getString("mcntimepicker.flyout.arialabel");this.flyout.element.setAttribute("aria-label",s.empty?"":s.value),this.element.appendChild(this.flyout.element),i.hasOwnProperty("deferRendering")||(i.deferRendering=!0);var r=document.createElement("DIV");this.flyout.element.appendChild(r);var o=JSON.parse(JSON.stringify(i));o.flyout=this.flyout,this.timeclock=new e.UI.TimeClock(r,o),this.timeclock.element.onmousewheel=function(e){e.preventDefault(),e.stopPropagation()},this.timeclock.onchange=function(){n.value=n.timeclock.value,n.flyout.hide(),n.dispatchEvent("change")},this.timeclock.onhourchange=function(){n.value=n.timeclock.value},this.flyout.onbeforeshow=function(){setImmediate(function(){n.timeclock.setFocus()})},this.flyout.onaftershow=function(){WinJS.UI&&WinJS.UI._LightDismissService&&WinJS.UI._LightDismissService._service&&WinJS.UI._LightDismissService._service._clickEaterEl&&WinJS.UI._LightDismissService._service._clickEaterEl.style&&WinJS.UI._LightDismissService._service._clickEaterEl.style.zIndex<1006&&(WinJS.UI._LightDismissService._service._clickEaterEl.style.zIndex="1006")},this.flyout.onafterhide=function(){n.timeclock.switchToHours()},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-timepicker-text tap",this.element.appendChild(this.textElement),this.textElement.tabIndex=0,this.textElement.setAttribute("role","button"),this.textElement.onclick=function(e){e.preventDefault(),e.stopPropagation(),window.innerWidth<500?n.flyout.show(document.body,"top","left"):n.flyout.show(n.textElement)},this.textElement.innerText=this.timeclock.value,WinJS.UI.setOptions(this,i)}return Object.defineProperty(t.prototype,"value",{get:function(){return this.timeclock.value},set:function(e){try{this.timeclock.value=e}catch(t){console.error(t)}this.textElement.innerText=this.timeclock.value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueAsDate",{get:function(){return this.timeclock.valueAsDate},set:function(e){this.timeclock.valueAsDate=e,this.textElement.innerText=this.timeclock.value},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},t.prototype.dispatchEvent=function(e,t){},t.prototype.addEventListener=function(e,t){},t}();t.TimePickerControl=l,t.TimePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(l),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var u=function(){function t(t,i){var n=this;if(this.element=t||document.createElement("DIV"),i=i||{},this.element.winControl=this,this.element.classList.add("mcn-timeclock"),this.element.classList.add("win-disposable"),this.eventTracker=new e.UI.EventTracker,i.radial&&this.element.classList.add("radial"),i.value||(this.valueAsDate=new Date),WinJS.UI.setOptions(this,i),this.flyout&&(this.element.classList.add("win-xyfocus-suspended"),this.eventTracker.addEvent(this.element,"keydown",this.onkeydown.bind(this),!0)),i.deferRendering){var s=e.Utils.getScopeControl(this.element);s?s.readyComplete&&s.readyComplete.then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){n.render()},WinJS.Utilities.Scheduler.Priority.idle)}):setTimeout(function(){WinJS.Utilities.Scheduler.schedule(function(){n.render()},WinJS.Utilities.Scheduler.Priority.idle)},2e3)}else this.render()}return t.prototype.render=function(){var t=this,i=WinJS.Resources.getString("mcntimepicker.mainminutes.arialabel"),n=WinJS.Resources.getString("mcntimepicker.mainhour.arialabel");this.element.innerHTML='<header>\n                    <button class="hours current" aria-label="'+(n.empty?"":n.value.format(this.hour))+'">'+e.Utils.pad2(this.hour)+'</button>\n                    <div class="sep">:</div>\n                    <button class="minutes"  aria-label="'+(n.empty?"":i.value.format(this.minutes))+'">'+e.Utils.pad2(this.minutes)+"</button>\n                </header>\n                <section>\n                </section>",this.header=this.element.querySelector("header"),this.content=this.element.querySelector("section"),this.hoursElt=this.element.querySelector(".hours"),e.UI.tap(this.hoursElt,function(){t.switchToHours()}),this.minutesElt=this.element.querySelector(".minutes"),e.UI.tap(this.minutesElt,function(){t.switchToMinutes()}),this.amLabel=this.amLabel||"AM",this.pmLabel=this.pmLabel||"PM",this.hoursPanel=new c(this),this.currentPanel=this.hoursPanel},t.prototype.onkeydown=function(e){if("PageDown"==e.key)this.toggleDisplay(),e.preventDefault(),e.stopPropagation();else if("PageUp"==e.key)this.toggleDisplay(),e.preventDefault(),e.stopPropagation();else if("Down"==e.key){var t=WinJS.UI.XYFocus.findNextFocusElement("down",{focusRoot:this.element});t?t.focus():this.currentPanel==this.hoursPanel&&this.hoursPanel.toggleView(),e.preventDefault(),e.stopPropagation()}else if("Up"==e.key){var t=WinJS.UI.XYFocus.findNextFocusElement("up",{focusRoot:this.element});t?t.focus():this.currentPanel==this.hoursPanel&&this.hoursPanel.toggleView(),e.preventDefault(),e.stopPropagation()}else if("Left"==e.key){var t=WinJS.UI.XYFocus.findNextFocusElement("left",{focusRoot:this.element});t&&t.focus(),e.preventDefault(),e.stopPropagation()}else if("Right"==e.key){var t=WinJS.UI.XYFocus.findNextFocusElement("right",{focusRoot:this.element});t&&t.focus(),e.preventDefault(),e.stopPropagation()}},Object.defineProperty(t.prototype,"value",{get:function(){return e.Utils.pad2(this.hour)+":"+e.Utils.pad2(this.minutes)},set:function(e){var t=e.split(":");this._value=moment(this._value).hour(parseInt(t[0],10)).minute(parseInt(t[1],10)).toDate(),this.updateDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueAsDate",{get:function(){return this._value},set:function(e){this._value=moment(e).toDate(),this.updateDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hour",{get:function(){return this._value.getHours()},set:function(e){this._value=moment(this._value).hour(e).toDate(),this.updateDisplay(),this.dispatchEvent("hourchange")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minutes",{get:function(){return this._value.getMinutes()},set:function(e){this._value=moment(this._value).minute(e).toDate(),this.updateDisplay(),this.dispatchEvent("change"),this.dispatchEvent("minutechange")},enumerable:!0,configurable:!0}),t.prototype.conformMinutes=function(){for(var e=this._value.getMinutes()||0,t=0;10>t&&e%5!=0;)e-=1,t++;this._value=moment(this._value).minute(e).toDate()},t.prototype.updateDisplay=function(){if(this.conformMinutes(),this.hoursElt){this.hoursElt.innerText=e.Utils.pad2(this.hour),this.minutesElt.innerText=e.Utils.pad2(this.minutes);var t=WinJS.Resources.getString("mcntimepicker.mainminutes.arialabel"),i=WinJS.Resources.getString("mcntimepicker.mainhour.arialabel");i.empty||this.hoursElt.setAttribute("aria-label",i.value.format(this.hour)),t.empty||this.minutesElt.setAttribute("aria-label",t.value.format(this.minutes))}this.currentPanel&&this.currentPanel.ensureValue()},t.prototype.toggleDisplay=function(){this.currentPanel==this.hoursPanel?this.switchToMinutes():this.switchToHours()},t.prototype.setFocus=function(){this.currentPanel&&this.currentPanel.setFocus()},t.prototype.switchToHours=function(){return this.currentPanel==this.hoursPanel?void this.hoursPanel.ensureValue():(this.currentPanel&&this.currentPanel!=this.hoursPanel&&this.currentPanel.remove(),this.hoursPanel?this.hoursPanel.ensureValue():this.hoursPanel=new c(this),this.minutesElt.classList.remove("current"),this.hoursElt.classList.add("current"),this.hoursPanel.show(),this.hoursPanel.setFocus(),void(this.currentPanel=this.hoursPanel))},t.prototype.switchToMinutes=function(){return this.currentPanel==this.minutesPanel?void this.minutesPanel.ensureValue():(this.currentPanel&&this.currentPanel!=this.minutesPanel&&this.currentPanel.remove(),this.minutesPanel?this.minutesPanel.ensureValue():this.minutesPanel=new m(this),this.minutesElt.classList.add("current"),this.hoursElt.classList.remove("current"),this.minutesPanel.show(),this.minutesPanel.setFocus(),void(this.currentPanel=this.minutesPanel))},t.prototype.dispatchEvent=function(e,t){},t.prototype.addEventListener=function(e,t){},t.prototype.dispose=function(){this.eventTracker.dispose()},t}();t.TimeClockControl=u,t.TimeClock=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(u),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change","hourchange","minutechange"));var h=function(){function t(e){this.parent=e,this.element=document.createElement("DIV"),this.element.className="timepanel",this.element.innerHTML="<header>\n                </header>\n                <section>\n                </section>",this.header=this.element.querySelector("header"),this.content=this.element.querySelector("section"),this.parent.content.appendChild(this.element)}return t.prototype.renderItems=function(t,i,n,s,r){var o=document.createElement("DIV");o.className="itemspanel";var a=document.createElement("DIV");a.className="items",o.appendChild(a);var l=WinJS.Resources.getString("mcntimepicker.hour.arialabel"),u=WinJS.Resources.getString("mcntimepicker.minutes.arialabel");return t.forEach(function(t){var r=document.createElement("BUTTON");r.className="timeitem item-"+i,r.id=i+t,"hour"!=i||l.empty?"min"!=i||u.empty||r.setAttribute("aria-label",t+" "+u.value):r.setAttribute("aria-label",t+" "+l.value),r.dataset.val=""+t,r.innerText=e.Utils.pad2(t),t==n&&r.classList.add("selected"),r.onclick=s,a.appendChild(r)}),this.parent.radial&&this.radialLayout(a),o},t.prototype.radialLayout=function(e){for(var t,i,n=80,s=130,r=38,o=0;12>o;o++){var a=e.children[o];t=o/6*Math.PI,i=n,a.style.left=s+Math.sin(t)*i-r+"px",a.style.top=s-Math.cos(t)*i-r+"px"}},t.prototype.remove=function(){var e=this;return WinJS.UI.Animation.drillInOutgoing(this.element).then(function(){e.element.classList.add("hidden"),e.element.style.display="none"})},t.prototype.show=function(){return this.element.classList.remove("hidden"),this.element.style.display="",WinJS.UI.Animation.drillInIncoming(this.element)},t.prototype.ensureValue=function(){},t.prototype.setFocus=function(){},t}();t.TimePanel=h;var c=function(t){function o(i){t.call(this,i),this.element.classList.add("hourspanel"),this.header.innerHTML='<button class="hoursel am">'+this.parent.amLabel+'</button>\n                <button class="hoursel pm">'+this.parent.pmLabel+"</button>",this.amButton=this.header.querySelector(".hoursel.am"),this.pmButton=this.header.querySelector(".hoursel.pm"),e.UI.tap(this.amButton,this.setAM.bind(this)),e.UI.tap(this.pmButton,this.setPM.bind(this)),this.init()}return __extends(o,t),o.prototype.init=function(){var e=this.parent.hour;if(0==e||e>12){var t=this.parent.radial?r:s;this.pmButton.classList.add("selected"),this.isAm=!1}else{var t=this.parent.radial?n:i;this.amButton.classList.add("selected"),this.isAm=!0}this.currentHours=this.renderItems(t,"hour",e,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours)},o.prototype.ensureValue=function(){var e=this.element.querySelector(".item-hour.selected");if(e){var t=parseInt(e.dataset.val,10);t!=this.parent.hour&&(e.classList.remove("selected"),this.currentHours.parentElement.removeChild(this.currentHours),this.init())}},o.prototype.toggleView=function(){this.isAm?this.setPM():this.setAM()},o.prototype.setFocus=function(){var e=this.currentHours.querySelector(".item-hour.selected");e||(e=e=this.currentHours.querySelector(".item-hour")),e&&e.focus()},o.prototype.setPM=function(){if(this.isAm){var e=this.currentHours;WinJS.UI.Animation.drillInOutgoing(e).then(function(){e.parentElement.removeChild(e)}),this.isAm=!1;var t=this.parent.radial?r:s;this.pmButton.classList.add("selected"),this.amButton.classList.remove("selected"),this.currentHours=this.renderItems(t,"hour",this.parent.hour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours),this.setFocus(),WinJS.UI.Animation.drillInIncoming(this.currentHours)}},o.prototype.setAM=function(){if(!this.isAm){var e=this.currentHours;WinJS.UI.Animation.drillInOutgoing(e).then(function(){e.parentElement.removeChild(e)}),this.isAm=!0;var t=this.parent.radial?n:i;this.pmButton.classList.remove("selected"),this.amButton.classList.add("selected"),this.currentHours=this.renderItems(t,"hour",this.parent.hour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours),this.setFocus(),WinJS.UI.Animation.drillInIncoming(this.currentHours)}},o.prototype.hourClicked=function(e){var t=e.target,i=this.parent.element.querySelector(".item-hour.selected");i&&i.classList.remove("selected"),t.classList.add("selected"),this.parent.hour=parseInt(t.dataset.val,10),this.parent.switchToMinutes()},o}(h);t.HoursPanel=c;var m=function(e){function t(t){e.call(this,t),this.element.classList.add("minutespanel");var i=o;this.parent.radial&&(i=a);var n=this.renderItems(i,"min",this.parent.minutes,this.minuteClicked.bind(this));this.content.appendChild(n)}return __extends(t,e),t.prototype.minuteClicked=function(e){var t=e.target,i=this.parent.element.querySelector(".item-min.selected");i&&i.classList.remove("selected"),t.classList.add("selected");var n=parseInt(t.dataset.val,10);this.parent.minutes=n},t.prototype.setFocus=function(){var e=this.content.querySelector(".item-min.selected");e||(e=e=this.content.querySelector(".item-min")),e&&e.focus()},t}(h);t.MinutesPanel=m}(t=e.UI||(e.UI={}))}(WinJSContrib||(WinJSContrib={}));