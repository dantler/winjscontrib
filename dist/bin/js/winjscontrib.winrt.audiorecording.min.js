/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var WinJSContrib=WinJSContrib||{};WinJSContrib.WinRT=WinJSContrib.WinRT||{},WinJSContrib.WinRT.Audio=WinJSContrib.WinRT.Audio||{},function(){"use strict";WinJSContrib.WinRT.Audio.RecorderState=WinJS.Binding.define({isRecording:!1,isPaused:!1,ellapsedTime:0,startedAt:null}),WinJSContrib.WinRT.Audio.Recorder=WinJS.Class.mix(WinJS.Class.define(function(){this.state=new WinJSContrib.WinRT.Audio.RecorderState,this.state.isRecording=!1,this.state.isPaused=!1},{start:function(e,i){var r=this,n=!1;return r.state.ellapsedTime=0,r.state.startedAt=new Date,i=i||{},r.recording={file:e,captureInitSettings:new Windows.Media.Capture.MediaCaptureInitializationSettings,encodingProfile:Windows.Media.MediaProperties.MediaEncodingProfile.createM4a(i.quality||Windows.Media.MediaProperties.AudioEncodingQuality.low),mediaCaptureMgr:new Windows.Media.Capture.MediaCapture,eventTracker:new WinJSContrib.UI.EventTracker,dispose:function(){this.eventTracker.dispose()}},r.recording.captureInitSettings.audioDeviceId=i.deviceId||"",r.recording.captureInitSettings.videoDeviceId="",r.recording.captureInitSettings.mediaCategory=Windows.Media.Capture.MediaCategory.other,r.recording.captureInitSettings.audioProcessing=n&&i.rawAudio?Windows.Media.AudioProcessing.raw:Windows.Media.AudioProcessing["default"],r.recording.captureInitSettings.streamingCaptureMode=Windows.Media.Capture.StreamingCaptureMode.audio,r.recording.eventTracker.addEvent(r.recording.mediaCaptureMgr,"failed",r._errorHandler.bind(r)),r.recording.eventTracker.addEvent(r.recording.mediaCaptureMgr,"recordlimitationexceeded",r._errorHandler.bind(r)),r.recording.mediaCaptureMgr.initializeAsync(r.recording.captureInitSettings).then(function(i){return r.state.isRecording=!0,r.state.isPaused=!1,r.ellapsedTimeInterval=setInterval(r._mesureEllapsedTime.bind(r),1e3),r.recording.mediaCaptureMgr.startRecordToStorageFileAsync(r.recording.encodingProfile,e).then(function(){return e})},r._errorHandler.bind(r))},pause:function(){var e=this;return e.state.isRecording?(e.state.isPaused=!0,clearInterval(e.ellapsedTimeInterval),e.recording.mediaCaptureMgr.pauseRecordAsync(Windows.Media.Devices.MediaCapturePauseBehavior.retainHardwareResources)):WinJS.Promise.wrap()},resume:function(){var e=this;return e.state.isPaused?(e.state.isPaused=!1,e.ellapsedTimeInterval=setInterval(e._mesureEllapsedTime.bind(e),1e3),e.recording.mediaCaptureMgr.resumeRecordAsync()):WinJS.Promise.wrap()},stop:function(){var e=this;if(e.state.isRecording=!1,e.state.isPaused=!1,clearInterval(e.ellapsedTimeInterval),e.recording){var i=e.recording;e._oldRecording=i,e.recording=null;var r=function(){return i.dispose(),e.dispatchEvent("recordingstopped"),WinJS.Promise.wrap(i.file)};return i.mediaCaptureMgr.stopRecordAsync().then(r,r)}return WinJS.Promise.wrap(null)},_mesureEllapsedTime:function(){var e=this,i=(new Date-e.state.startedAt)/1e3;e.state.ellapsedTime=i},_errorHandler:function(e){var i=this;i.recording.dispose(),i._oldRecording=i.recording,i.recording=null,i.state.isRecording=!1,i.dispatchEvent("recordingstopped"),i.dispatchEvent("error",e),clearInterval(i.ellapsedTimeInterval)}}),WinJS.Utilities.eventMixin),WinJSContrib.WinRT.Audio.Recorder.getMicrophones=function(){var e=Windows.Devices.Enumeration.DeviceInformation;return e.findAllAsync(Windows.Media.Devices.MediaDevice.getAudioCaptureSelector(),null).then(function(e){var i=[];if(e&&e.length>0)for(var r=0;r<e.length;r++)i.push(e[r]);return i},function(){return[]})}}();