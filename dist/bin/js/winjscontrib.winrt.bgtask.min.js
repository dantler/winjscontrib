/* 
 * WinJS Contrib v2.1.0.7
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var WinJSContrib=WinJSContrib||{};WinJSContrib.WinRT=WinJSContrib.WinRT||{},WinJSContrib.WinRT.BgTask=WinJSContrib.WinRT.BgTask||{},function(){"use strict";function n(n){console.info("clear all bg task");for(var r=Windows.ApplicationModel.Background,e=r.BackgroundTaskRegistration.allTasks.first(),i=e.hasCurrent;i;){var t=e.current.value;console.log("clear bgtask "+t.name+" "+t.taskId),t.unregister(n||!1),i=e.moveNext()}return!1}function r(n,r){for(var e=Windows.ApplicationModel.Background,i=e.BackgroundTaskRegistration.allTasks.first(),t=i.hasCurrent;t;){var a=i.current.value;if(a.name===n)return a.unregister(r||!1),!0;t=i.moveNext()}return!1}function e(n){for(var r=Windows.ApplicationModel.Background,e=r.BackgroundTaskRegistration.allTasks.first(),i=e.hasCurrent;i;){var t=e.current.value;if(t.name===n)return t;i=e.moveNext()}return!1}function i(n){n.addEventListener("completed",function(r){WinJS.Application.queueEvent({type:"MCN.BackgroundTask.Completed",arg:r,task:n})}),n.addEventListener("progress",function(r){WinJS.Application.queueEvent({type:"MCN.BackgroundTask.Progress",arg:r,task:n})})}WinJSContrib.WinRT.BgTask.clearAll=n,WinJSContrib.WinRT.BgTask.remove=r,WinJSContrib.WinRT.BgTask.registerBackgroundTask=function(n,r,t,a){console.log("register bg task "+r);var o=e(r);if(o)return console.log("bg task "+r+" already exists"),void i(o);var s=Windows.Storage.ApplicationData.current.localSettings;s.values.remove(r);try{var c=new Windows.ApplicationModel.Background.BackgroundTaskBuilder;c.name=r,c.taskEntryPoint=n,t.forEach(function(n){c.setTrigger(n)}),a&&a.length&&a.forEach(function(n){c.addCondition(n)});var u=c.register();i(u)}catch(g){return console.error("unable to register background task "+r,g),WinJS.Promise.wrapError(g)}},WinJSContrib.WinRT.BgTask.registerTimeTriggerBackgroundTask=function(n,r,e,i){try{return Windows.ApplicationModel.Background.BackgroundExecutionManager.requestAccessAsync().then(function(t){return t===Windows.ApplicationModel.Background.BackgroundAccessStatus.allowedWithAlwaysOnRealTimeConnectivity||t===Windows.ApplicationModel.Background.BackgroundAccessStatus.allowedMayUseActiveRealTimeConnectivity?WinJSContrib.WinRT.BgTask.registerBackgroundTask(n,r,e,i):void 0})}catch(t){}}}();